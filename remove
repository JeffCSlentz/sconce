#!/bin/bash
# remove_sconce.sh: Remove the sconce container system service.

SERVICE_NAME="sconce"
SYSTEMD_PATH="/etc/systemd/system/${SERVICE_NAME}.container"
VOLUME_PATH="/srv/${SERVICE_NAME}"

echo "Starting removal of $SERVICE_NAME..."

# Check if running as root
if [ "$(id -u)" != "0" ]; then
   echo "This script must be run as root (use sudo)."
   exit 1
fi

# 1. Stop and disable the service
echo "Stopping and disabling ${SERVICE_NAME}.service..."
systemctl stop "${SERVICE_NAME}.service"
systemctl disable "${SERVICE_NAME}.service"

# 2. Remove the systemd file
echo "Removing systemd file: $SYSTEMD_PATH"
rm -f "$SYSTEMD_PATH"

# 3. Reload systemd configuration
echo "Reloading systemd daemon..."
systemctl daemon-reload

# 4. Optional: Remove the volume data directory
read -p "Do you want to delete the volume data directory ($VOLUME_PATH)? [y/N]: " confirm
if [[ "$confirm" == [yY] || "$confirm" == [yY][eE][sS] ]]; then
    echo "Removing volume directory..."
    rm -rf "$VOLUME_PATH"
fi

echo "Removal complete."